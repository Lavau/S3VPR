2024-05-01 01:53:10   Arguments: Namespace(aggregator_name='gemhead', backbone_name='deit3_base_patch16_224', device='cuda', dim=768, epochs_num=80, foundation_model_path='pth/dinov2_vitb14_pretrain.pth', infer_batch_size=300, kernel_size=3, lr=0.0001, mlp_ratio=1, nc=4096, num_trainable_blocks=4, num_workers=4, optim='adam', patience=3, recall_values=[1, 5, 10, 100], resize=[224, 224], save_dir='logs/2024-05-01_01-53-10', seed=0, train_batch_size=160, val_set_names=['msls_val'])
2024-05-01 01:53:10   The outputs are being saved in logs/2024-05-01_01-53-10
2024-05-01 01:53:10   validation dataset names:['msls_val']
2024-05-01 01:53:15   Using 2 GPUs and 64 CPUs
2024-05-01 01:53:16   Loading pretrained weights from url (https://dl.fbaipublicfiles.com/deit/deit_3_base_224_1k.pth)
2024-05-01 01:53:19   GeoLocalizationNet(
  (backbone): DeiT(
    (model): VisionTransformer(
      (patch_embed): PatchEmbed(
        (proj): Conv2d(3, 768, kernel_size=(16, 16), stride=(16, 16))
        (norm): Identity()
      )
      (pos_drop): Dropout(p=0.0, inplace=False)
      (norm_pre): Identity()
      (blocks): Sequential(
        (0): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (1): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (2): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (3): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (4): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (5): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (6): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (7): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (8): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (9): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (10): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
        (11): Block(
          (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (attn): Attention(
            (qkv): Linear(in_features=768, out_features=2304, bias=True)
            (attn_drop): Dropout(p=0.0, inplace=False)
            (proj): Linear(in_features=768, out_features=768, bias=True)
            (proj_drop): Dropout(p=0.0, inplace=False)
          )
          (ls1): LayerScale()
          (drop_path1): Identity()
          (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
          (mlp): Mlp(
            (fc1): Linear(in_features=768, out_features=3072, bias=True)
            (act): GELU(approximate='none')
            (drop1): Dropout(p=0.0, inplace=False)
            (fc2): Linear(in_features=3072, out_features=768, bias=True)
            (drop2): Dropout(p=0.0, inplace=False)
          )
          (ls2): LayerScale()
          (drop_path2): Identity()
        )
      )
      (norm): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
      (fc_norm): Identity()
      (head): Linear(in_features=768, out_features=1000, bias=True)
    )
  )
  (aggregator): GeMHead(
    (pool): GeneralizedMeanPooling(3.0, output_size=1)
    (fc): Linear(in_features=768, out_features=4096, bias=True)
  )
)
2024-05-01 01:53:20   Val set: < MSLS, msls-val - #database: 18871; #queries: 747 >
2024-05-01 01:53:20   Start training epoch: 00
2024-05-01 02:20:54   Finished epoch 00 in 0:27:33, average epoch loss = 1.0214
2024-05-01 02:22:20   Ranking results: msls_val R@1: 0.6527, R@5: 0.8027, R@10: 0.8243, R@15: 0.8459, R@20: 0.8608, R@50: 0.9095, R@100: 0.9270
2024-05-01 02:22:23   Improved: previous msls-val best R@1 = 0.0000, current R@1 = 0.6527
2024-05-01 02:22:23   Start training epoch: 01
2024-05-01 02:50:50   Finished epoch 01 in 0:28:26, average epoch loss = 0.8233
2024-05-01 02:52:15   Ranking results: msls_val R@1: 0.7000, R@5: 0.8230, R@10: 0.8473, R@15: 0.8608, R@20: 0.8784, R@50: 0.9095, R@100: 0.9311
2024-05-01 02:52:22   Improved: previous msls-val best R@1 = 0.6527, current R@1 = 0.7000
2024-05-01 02:52:22   Start training epoch: 02
2024-05-01 03:20:44   Finished epoch 02 in 0:28:22, average epoch loss = 0.7506
2024-05-01 03:22:10   Ranking results: msls_val R@1: 0.7135, R@5: 0.8324, R@10: 0.8527, R@15: 0.8716, R@20: 0.8865, R@50: 0.9189, R@100: 0.9432
2024-05-01 03:22:17   Improved: previous msls-val best R@1 = 0.7000, current R@1 = 0.7135
2024-05-01 03:22:17   Start training epoch: 03
2024-05-01 03:50:41   Finished epoch 03 in 0:28:23, average epoch loss = 0.7003
2024-05-01 03:52:06   Ranking results: msls_val R@1: 0.7432, R@5: 0.8365, R@10: 0.8514, R@15: 0.8730, R@20: 0.8865, R@50: 0.9230, R@100: 0.9405
2024-05-01 03:52:14   Improved: previous msls-val best R@1 = 0.7135, current R@1 = 0.7432
2024-05-01 03:52:14   Start training epoch: 04
2024-05-01 04:20:35   Finished epoch 04 in 0:28:20, average epoch loss = 0.6698
2024-05-01 04:22:01   Ranking results: msls_val R@1: 0.7324, R@5: 0.8392, R@10: 0.8581, R@15: 0.8784, R@20: 0.8905, R@50: 0.9216, R@100: 0.9378
2024-05-01 04:22:05   Not improved: 1 / 3: msls-val best R@1 = 0.7432, current R@1 = 0.7324
2024-05-01 04:22:05   Start training epoch: 05
2024-05-01 04:50:27   Finished epoch 05 in 0:28:22, average epoch loss = 0.6519
2024-05-01 04:51:53   Ranking results: msls_val R@1: 0.7500, R@5: 0.8392, R@10: 0.8622, R@15: 0.8851, R@20: 0.8892, R@50: 0.9284, R@100: 0.9405
2024-05-01 04:52:00   Improved: previous msls-val best R@1 = 0.7432, current R@1 = 0.7500
2024-05-01 04:52:00   Start training epoch: 06
2024-05-01 05:20:24   Finished epoch 06 in 0:28:24, average epoch loss = 0.6276
2024-05-01 05:21:50   Ranking results: msls_val R@1: 0.7473, R@5: 0.8392, R@10: 0.8689, R@15: 0.8811, R@20: 0.8878, R@50: 0.9243, R@100: 0.9392
2024-05-01 05:21:54   Not improved: 1 / 3: msls-val best R@1 = 0.7500, current R@1 = 0.7473
2024-05-01 05:21:54   Start training epoch: 07
2024-05-01 05:50:24   Finished epoch 07 in 0:28:30, average epoch loss = 0.6172
2024-05-01 05:51:49   Ranking results: msls_val R@1: 0.7500, R@5: 0.8419, R@10: 0.8757, R@15: 0.8878, R@20: 0.8932, R@50: 0.9257, R@100: 0.9365
2024-05-01 05:51:53   Not improved: 2 / 3: msls-val best R@1 = 0.7500, current R@1 = 0.7500
2024-05-01 05:51:53   Start training epoch: 08
2024-05-01 06:19:58   Finished epoch 08 in 0:28:05, average epoch loss = 0.6048
2024-05-01 06:21:23   Ranking results: msls_val R@1: 0.7649, R@5: 0.8473, R@10: 0.8689, R@15: 0.8838, R@20: 0.8946, R@50: 0.9243, R@100: 0.9365
2024-05-01 06:21:30   Improved: previous msls-val best R@1 = 0.7500, current R@1 = 0.7649
2024-05-01 06:21:30   Start training epoch: 09
2024-05-01 06:45:06   Finished epoch 09 in 0:23:36, average epoch loss = 0.5963
2024-05-01 06:46:29   Ranking results: msls_val R@1: 0.7500, R@5: 0.8459, R@10: 0.8662, R@15: 0.8811, R@20: 0.8905, R@50: 0.9243, R@100: 0.9365
2024-05-01 06:46:33   Not improved: 1 / 3: msls-val best R@1 = 0.7649, current R@1 = 0.7500
2024-05-01 06:46:33   Start training epoch: 10
2024-05-01 07:10:35   Finished epoch 10 in 0:24:02, average epoch loss = 0.5881
2024-05-01 07:11:23   Ranking results: msls_val R@1: 0.7514, R@5: 0.8432, R@10: 0.8649, R@15: 0.8797, R@20: 0.8905, R@50: 0.9189, R@100: 0.9378
2024-05-01 07:11:27   Not improved: 2 / 3: msls-val best R@1 = 0.7649, current R@1 = 0.7514
2024-05-01 07:11:27   Start training epoch: 11
2024-05-01 07:27:55   Finished epoch 11 in 0:16:28, average epoch loss = 0.5819
2024-05-01 07:28:39   Ranking results: msls_val R@1: 0.7635, R@5: 0.8432, R@10: 0.8703, R@15: 0.8811, R@20: 0.8959, R@50: 0.9189, R@100: 0.9338
2024-05-01 07:28:43   Not improved: 3 / 3: msls-val best R@1 = 0.7649, current R@1 = 0.7635
2024-05-01 07:28:43   Performance did not improve for 3 epochs. Stop training.
2024-05-01 07:28:43   Best  msls-val best R@1 = 0.7649
2024-05-01 07:28:43   Trained for 12 epochs, in total in 5:35:32
2024-05-01 07:28:43   Val set: < MSLS, msls-val - #database: 18871; #queries: 747 >
2024-05-01 07:28:43   Val set: < Tokyo247Dataset, Tokyo - #database: 75984; #queries: 423 >
2024-05-01 07:28:43   Val set: < SPEDDataset, SPED - #database: 607; #queries: 607 >
2024-05-01 07:28:43   Val set: < NordlandDataset, nordland - #database: 27592; #queries: 2760 >
2024-05-01 07:28:43   Val set: < WholeDatasetFromStruct, pitts30k_val - #database: 10000; #queries: 7608 >
2024-05-01 07:28:43   Val set: < WholeDatasetFromStruct, pitts30k_test - #database: 10000; #queries: 6816 >
2024-05-01 07:28:43   Val set: < WholeDatasetFromStruct, pitts250k_test - #database: 83952; #queries: 8280 >
2024-05-01 07:28:44   Val set: < WholeDatasetFromStruct, pitts250k_val - #database: 78648; #queries: 7608 >
2024-05-01 07:28:44   Test *best* model on test set
2024-05-01 07:29:29   Ranking results: msls_val R@1: 0.7649, R@5: 0.8473, R@10: 0.8689, R@15: 0.8838, R@20: 0.8946, R@50: 0.9243, R@100: 0.9365
2024-05-01 07:35:38   Ranking results: tokyo247 R@1: 0.5272, R@5: 0.6619, R@10: 0.7139, R@15: 0.7494, R@20: 0.7754, R@50: 0.8322, R@100: 0.8700
2024-05-01 07:35:43   Ranking results: SPED R@1: 0.7035, R@5: 0.8204, R@10: 0.8600, R@15: 0.8863, R@20: 0.8995, R@50: 0.9259, R@100: 0.9473
2024-05-01 07:36:56   Ranking results: nordland R@1: 0.1022, R@5: 0.1909, R@10: 0.2359, R@15: 0.2609, R@20: 0.2815, R@50: 0.3529, R@100: 0.4283
2024-05-01 07:37:45   Ranking results: pitts30k_val R@1: 0.8767, R@5: 0.9633, R@10: 0.9783, R@15: 0.9841, R@20: 0.9880, R@50: 0.9954, R@100: 0.9980
2024-05-01 07:38:31   Ranking results: pitts30k_test R@1: 0.8643, R@5: 0.9379, R@10: 0.9532, R@15: 0.9611, R@20: 0.9657, R@50: 0.9770, R@100: 0.9820
2024-05-01 07:43:15   Ranking results: pitts250k_test R@1: 0.8737, R@5: 0.9518, R@10: 0.9681, R@15: 0.9739, R@20: 0.9783, R@50: 0.9870, R@100: 0.9915 
2024-05-01 07:47:33   Ranking results: pitts250k_val R@1: 0.8600, R@5: 0.9444, R@10: 0.9608, R@15: 0.9679, R@20: 0.9711, R@50: 0.9829, R@100: 0.9895
2024-05-01 07:47:33   Test *last* model on test set 
2024-05-01 07:48:18   Ranking results: msls_val R@1: 0.7635, R@5: 0.8432, R@10: 0.8703, R@15: 0.8811, R@20: 0.8959, R@50: 0.9189, R@100: 0.9338 
2024-05-01 07:54:33   Ranking results: tokyo247 R@1: 0.5177, R@5: 0.6714, R@10: 0.7281, R@15: 0.7541, R@20: 0.7683, R@50: 0.8369, R@100: 0.8723 
2024-05-01 07:54:38   Ranking results: SPED R@1: 0.7051, R@5: 0.8221, R@10: 0.8682, R@15: 0.8847, R@20: 0.9028, R@50: 0.9275, R@100: 0.9440 
2024-05-01 07:55:52   Ranking results: nordland R@1: 0.1065, R@5: 0.1924, R@10: 0.2409, R@15: 0.2674, R@20: 0.2884, R@50: 0.3674, R@100: 0.4373 
2024-05-01 07:56:41   Ranking results: pitts30k_val R@1: 0.8749, R@5: 0.9642, R@10: 0.9787, R@15: 0.9842, R@20: 0.9874, R@50: 0.9945, R@100: 0.9984 
2024-05-01 07:57:27   Ranking results: pitts30k_test R@1: 0.8653, R@5: 0.9387, R@10: 0.9545, R@15: 0.9610, R@20: 0.9665, R@50: 0.9776, R@100: 0.9821 
2024-05-01 08:02:09   Ranking results: pitts250k_test R@1: 0.8763, R@5: 0.9537, R@10: 0.9703, R@15: 0.9751, R@20: 0.9785, R@50: 0.9870, R@100: 0.9914 
2024-05-01 08:06:28   Ranking results: pitts250k_val R@1: 0.8596, R@5: 0.9449, R@10: 0.9616, R@15: 0.9670, R@20: 0.9707, R@50: 0.9817, R@100: 0.9883
